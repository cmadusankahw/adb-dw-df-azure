{
	"name": "UpdateCustomerSCDT1",
	"properties": {
		"folder": {
			"name": "version-history"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "Customers",
						"type": "DatasetReference"
					},
					"name": "sourceCustomer"
				},
				{
					"dataset": {
						"referenceName": "customers_staged",
						"type": "DatasetReference"
					},
					"name": "dimCustomerDumped"
				}
			],
			"sinks": [],
			"transformations": [
				{
					"name": "CreateCustomerHash"
				},
				{
					"name": "IfExists"
				},
				{
					"name": "LookupCustomerID"
				},
				{
					"name": "SetDates"
				},
				{
					"name": "AllowUpserts"
				}
			],
			"script": "source(output(\n\t\tcustomer_id as string,\n\t\tcustomer_unique_id as string,\n\t\tcustomer_zip_code_prefix as integer,\n\t\tcustomer_city as string,\n\t\tcustomer_state as string,\n\t\tage as integer,\n\t\tgender as string,\n\t\tname as string,\n\t\tmarital_status as string,\n\t\tincome as string,\n\t\temployement_status as string,\n\t\tjob_role as string,\n\t\tphone_no as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> sourceCustomer\nsource(output(\n\t\tcustomer_id as string,\n\t\tcustomer_unique_id as string,\n\t\tcustomer_zip_code_prefix as string,\n\t\tcustomer_city as string,\n\t\tcustomer_state as string,\n\t\tbirth_date as string,\n\t\tgender as string,\n\t\tname as string,\n\t\tmarital_status as string,\n\t\tincome as string,\n\t\temployement_status as string,\n\t\tjob_role as string,\n\t\tphone_no as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> dimCustomerDumped\nsourceCustomer derive(Hashkey = sha2(256, iifNull(customer_id,'')  +iifNull(customer_unique_id,'') +iifNull(customer_state,'') \r\n+iifNull(customer_city,'') \r\n+iifNull(name,'') \r\n+iifNull(gender,'')\r\n+iifNull(job_role,'')\r\n+iifNull(marital_status,'')\r\n+iifNull(employement_status,'')\r\n+iifNull(income,'')\r\n+iifNull(phone_no,''))) ~> CreateCustomerHash\nCreateCustomerHash, dimCustomerDumped exists(Hashkey == ERROR_FUNCTION(''),\n\tnegate:true,\n\tbroadcast: 'auto')~> IfExists\nIfExists, dimCustomerDumped lookup(sourceCustomer@customer_id == dimCustomerDumped@customer_id,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> LookupCustomerID\nLookupCustomerID derive(InsertedDate = iif(isNull(InsertedDate), currentTimestamp(), {InsertedDate}),\n\t\tModifiedDate = currentTimestamp()) ~> SetDates\nSetDates alterRow(updateIf(true())) ~> AllowUpserts"
		}
	}
}